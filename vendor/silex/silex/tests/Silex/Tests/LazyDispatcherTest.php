<?php
 namespace Silex\Tests; use PHPUnit\Framework\TestCase; use Silex\Application; use Symfony\Component\HttpFoundation\Request; class LazyDispatcherTest extends TestCase { public function beforeMiddlewareShouldNotCreateDispatcherEarly() { $dispatcherCreated = false; $app = new Application(); $app->extend('dispatcher', function ($dispatcher, $app) use (&$dispatcherCreated) { $dispatcherCreated = true; return $dispatcher; }); $app->before(function () {}); $this->assertFalse($dispatcherCreated); $request = Request::create('/'); $app->handle($request); $this->assertTrue($dispatcherCreated); } public function eventHelpersShouldDirectlyAddListenersAfterBoot() { $app = new Application(); $fired = false; $app->get('/', function () use ($app, &$fired) { $app->finish(function () use (&$fired) { $fired = true; }); }); $request = Request::create('/'); $response = $app->handle($request); $app->terminate($request, $response); $this->assertTrue($fired, 'Event was not fired'); } } 
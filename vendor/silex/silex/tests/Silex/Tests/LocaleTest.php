<?php
 namespace Silex\Tests; use PHPUnit\Framework\TestCase; use Silex\Application; use Silex\Provider\LocaleServiceProvider; use Symfony\Component\HttpFoundation\Request; use Symfony\Component\HttpKernel\HttpKernelInterface; class LocaleTest extends TestCase { public function testLocale() { $app = new Application(); $app->register(new LocaleServiceProvider()); $app->get('/', function (Request $request) { return $request->getLocale(); }); $response = $app->handle(Request::create('/')); $this->assertEquals('en', $response->getContent()); $app = new Application(); $app->register(new LocaleServiceProvider()); $app['locale'] = 'fr'; $app->get('/', function (Request $request) { return $request->getLocale(); }); $response = $app->handle(Request::create('/')); $this->assertEquals('fr', $response->getContent()); $app = new Application(); $app->register(new LocaleServiceProvider()); $app->get('/{_locale}', function (Request $request) { return $request->getLocale(); }); $response = $app->handle(Request::create('/es')); $this->assertEquals('es', $response->getContent()); } public function testLocaleInSubRequests() { $app = new Application(); $app->register(new LocaleServiceProvider()); $app->get('/embed/{_locale}', function (Request $request) { return $request->getLocale(); }); $app->get('/{_locale}', function (Request $request) use ($app) { return $request->getLocale().$app->handle(Request::create('/embed/es'), HttpKernelInterface::SUB_REQUEST)->getContent().$request->getLocale(); }); $response = $app->handle(Request::create('/fr')); $this->assertEquals('fresfr', $response->getContent()); $app = new Application(); $app->register(new LocaleServiceProvider()); $app->get('/embed', function (Request $request) { return $request->getLocale(); }); $app->get('/{_locale}', function (Request $request) use ($app) { return $request->getLocale().$app->handle(Request::create('/embed'), HttpKernelInterface::SUB_REQUEST)->getContent().$request->getLocale(); }); $response = $app->handle(Request::create('/fr')); $this->assertEquals('frenfr', $response->getContent()); } public function testLocaleWithBefore() { $app = new Application(); $app->register(new LocaleServiceProvider()); $app->before(function (Request $request) use ($app) { $request->setLocale('fr'); }); $app->get('/embed', function (Request $request) { return $request->getLocale(); }); $app->get('/', function (Request $request) use ($app) { return $request->getLocale().$app->handle(Request::create('/embed'), HttpKernelInterface::SUB_REQUEST)->getContent().$request->getLocale(); }); $response = $app->handle(Request::create('/')); $this->assertEquals('frenfr', $response->getContent()); } } 